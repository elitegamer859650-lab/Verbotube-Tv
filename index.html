<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VerboTube TV - Live Environment</title>
    <style>
        body, html { margin: 0; padding: 0; background: #000; overflow: hidden; width: 100%; height: 100%; }
        
        /* Video wrapper to handle scale/crop */
        .video-wrapper { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        
        /* YouTube Player - Scale hidden logos at edges */
        #player { transform: scale(1.12); transform-origin: center; width: 100%; height: 100%; }

        /* ðŸŒ™ LEFT SIDE LOGO MASK (For Shan-e-Ramzan Video) */
        #left-mask { 
            position: absolute; 
            top: 25px; left: 35px; 
            width: 200px; height: 110px; 
            background: #000; z-index: 200; 
            display: none; border-radius: 8px;
            box-shadow: 0 0 30px rgba(0,0,0,1);
        }

        /* VerboTube Branding */
        .verbo-logo { 
            position: absolute; top: 40px; right: 50px; 
            z-index: 201; color: #ff0000; 
            font-family: 'Arial Black', sans-serif; font-size: 30px; 
            text-shadow: 3px 3px 6px #000;
        }

        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-family: sans-serif; }
        .start-btn { padding: 20px 40px; background: red; color: white; border: none; cursor: pointer; border-radius: 50px; font-weight: bold; font-size: 20px; }
    </style>
</head>
<body>

    <div id="splash">
        <h1 style="letter-spacing: 5px;">VERBOTUBE TV</h1>
        <p>Environment Ready</p>
        <button class="start-btn" onclick="startTV()">START BROADCAST</button>
    </div>

    <div class="video-wrapper">
        <div id="player"></div>
        <div id="left-mask"></div> 
        <div class="verbo-logo">VerboTube <span style="color:white">LIVE</span></div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let localVersion = -1;
        const bumperID = 'rUcu5SL_I1k'; // Shan-e-Ramzan Video

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%',
                videoId: '', 
                playerVars: { 'autoplay': 1, 'controls': 0, 'rel': 0, 'showinfo': 0, 'mute': 1 },
                events: { 'onReady': onPlayerReady }
            });
        }

        function onPlayerReady() {
            // Har 5 second baad Admin se update lega
            setInterval(syncWithAdmin, 5000);
        }

        async function syncWithAdmin() {
            try {
                const response = await fetch('/api/stream');
                const data = await response.json();

                // Agar naya video version aya hai
                if (data.current_version > localVersion) {
                    localVersion = data.current_version;
                    const latest = data.playlist[data.playlist.length - 1];
                    
                    if (latest.mask === 'top-right' || latest.mask === 'top-left' || latest.mask === 'drama') {
                        playWithBumper(latest.url);
                    } else {
                        player.loadVideoById(latest.url);
                    }
                }
            } catch (err) { console.log("Sync error..."); }
        }

        function startTV() {
            document.getElementById('splash').style.display = 'none';
            player.unMute();
            syncWithAdmin(); // Pehli video uthao
        }

        function playWithBumper(videoID) {
            // 1. Show Mask and Play Bumper
            document.getElementById('left-mask').style.display = 'block';
            player.loadVideoById(bumperID);

            // 2. Wait 27s then play Drama
            setTimeout(() => {
                document.getElementById('left-mask').style.display = 'none';
                player.loadVideoById(videoID);
            }, 27000);
        }
    </script>
</body>
</html>
